# rag-from-pdf

The advantages of RAG:

1. cost efficiency: Token is the currency of LLM. The more number of tokens in the request, the more expensive the call will be.
   By using similarity searching, only the more relevant info can be provided to LLM, not all the info.

2. up-to-date response: Every LLM has its cut off date.
   by providing more up-to-date info, the more up-to-date response can be generated by LLM.

3. privacy concern: You don't want LLM to be trained with your privacy data.
   Hence, one should only provide the more private data to LLM when the call is being made
   such that an more customized response can be generated by LLM.

# Usage / Test with RAG:

   prerequisite: 

   1. run ollama commands to start LLM and download the embeeding:

    ollama serve
    ollama list
    ollama run tinyllama:latest
    ollama pull mxbai-embed-large:latest
      
   2. run docker command and, then, SQL commands listed in schema.sql:

    docker exec -it rag-from-pdf-container psql -U myuser -d mydb

    CREATE EXTENSION IF NOT EXISTS vector;
    CREATE EXTENSION IF NOT EXISTS hstore;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

    CREATE TABLE IF NOT EXISTS vector_store (
        id uuid DEFAULT uuid_generate_v4() PRIMARY KEY,
        content text,
        metadata json,
        embedding vector(1024)
    );

    CREATE INDEX ON vector_store USING HNSW (embedding vector_cosine_ops);

   3. put the pdf to resources folder and, then, add it to application.properties file.

    pdf.file.path=classpath:/docs/spring-boot-reference.pdf

   request:

    curl --location --request GET 'http://localhost:8080/rag-from-pdf' \
    --header 'Content-Type: application/json' \
    --data 'when is Taiwan Han Kuang 41 Exercise for year 2025 ?'

   response from tinyllama:latest + RAG (It is found in the pdf file, classpath:/docs/han-kuang-41-part2.pdf):

    When is Taiwan's largest military exercise, Han Kuang 41, scheduled to take place for year 2025?

    Answer: The annual Taiwanese-American-led military exercise called Han Kuang 41 is scheduled to begin on July 9 and last for 10 days of live-fire drills with some 22,000 reservists participating. The 2027 scenario involves a gray zone activity that could escalate into a military conflict as suggested by Riley Walterson, a senior fellow at the Hudson Institute, during a panel discussion hosted by the Hudson Institute on July 11. However, part of its success may also depend on U.S. Participation, which is missing. The United States' absence from Han Kuang not only limits its efficacy but also incur heavy costs in case of an actual invasion scenario.

# Test without RAG:

   2025 Taiwan Han Kuang Exercise is happening right now. (From July 9th to July 18th).
   Below are the responses from 
   1. OpenAI,
   2. Anthropic,
   3. Ollama

   on 2025/07/17 when asking "when is Taiwan Han Kuang 41 Exercise for year 2025 ?", 

   1. OpenAI:
   
    {
    "id": "chatcmpl-BuP7zxXBDiGwNJFeh2d58RCJFj2Xf",
    "object": "chat.completion",
    "created": 1752782659,
    "model": "gpt-4o-mini-2024-07-18",
    "choices": [
        {
            "index": 0,
            "message": {
                "role": "assistant",
                "content": "As of my last update in October 2023, specific dates for the Taiwan Han Kuang 41 Exercise in 2025 had not been publicly announced. The Han Kuang exercises are typically held annually, usually in July, but the specific schedule for 2025 may not yet be available. For the most accurate and updated information, you may want to check official announcements from Taiwan's Ministry of National Defense closer to the date.",
                "refusal": null,
                "annotations": []
            },
            "logprobs": null,
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 22,
        "completion_tokens": 87,
        "total_tokens": 109,
        "prompt_tokens_details": {
            "cached_tokens": 0,
            "audio_tokens": 0
        },
        "completion_tokens_details": {
            "reasoning_tokens": 0,
            "audio_tokens": 0,
            "accepted_prediction_tokens": 0,
            "rejected_prediction_tokens": 0
        }
    },
    "service_tier": "default",
    "system_fingerprint": null
    }

   2. Anthropic: 

    {
    "id": "msg_01DzPpqitVGNmfbwSi3wkfLh",
    "type": "message",
    "role": "assistant",
    "model": "claude-3-5-sonnet-20241022",
    "content": [
        {
            "type": "text",
            "text": "I cannot provide the exact dates for Taiwan's Han Kuang 41 Exercise in 2025, as this information has not been officially announced yet. The Han Kuang exercises are Taiwan's largest annual military drills, but the specific dates are typically announced closer to the time of the exercise, usually a few months before they take place. Historically, these exercises often occur during the summer months."
        }
    ],
    "stop_reason": "end_turn",
    "stop_sequence": null,
    "usage": {
        "input_tokens": 25,
        "cache_creation_input_tokens": 0,
        "cache_read_input_tokens": 0,
        "output_tokens": 86,
        "service_tier": "standard"
    }
    }

   3. Ollama (tinyllama:latest):

    The exact date of the Taiwan Han Kuang 41 Exercise for year 2025 has not yet been announced. The military exercise usually takes place in June or July and is held to strengthen joint cooperation 
    between the Chinese People's Liberation Army (PLA) and the respective navies of the participating countries. The Han Kuang exercises aim at promoting interoperability, enhancing situational 
    awareness, developing combat readiness, and building trust between the two military alliances involved in the exercises. Taiwan participates in this exercise as part of the PLA's strategy for 
    ensuring the country's defense against any potential threats from China.
   
# Troubleshootings:

-----

Question #1: When starting the spring boot app, PGVector is not up.

Answer #1: You could manually run the following.

    %  docker compose --file /Users/charles/IdeaProjects/rag-from-pdf/compose.yaml --ansi never up --no-color --detach --wait

-----

Question #2: Can I use OpenAI Free Account ?

Answer #2: You might get the following error if you are using OpenAI Free Account (even when performing the word2vec process to populate the db table)

    Caused by: org.springframework.ai.retry.NonTransientAiException: HTTP 429 - {
    "error": {
        "message": "You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.",
        "type": "insufficient_quota",
        "param": null,
        "code": "insufficient_quota"
    }
    }

----- 









